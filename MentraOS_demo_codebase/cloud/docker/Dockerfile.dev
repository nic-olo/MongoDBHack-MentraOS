FROM oven/bun:latest

# Install ca-certificates for SSL/TLS connections
RUN apt-get update && apt-get install -y ca-certificates && rm -rf /var/lib/apt/lists/*

ENV NODE_ENV=development
ENV CONTAINER_ENVIRONMENT=true

# Bun specific optimizations
ENV BUN_INSTALL_CACHE_DIR=/root/.bun/.cache
ENV BUN_INSTALL_GLOBAL_DIR=/root/.bun/install/global

WORKDIR /app

# Copy package.json and tsconfig files
COPY package.json tsconfig.json tsconfig.base.json ./
COPY packages/types/package.json packages/types/tsconfig.json ./packages/types/
COPY packages/sdk/package.json packages/sdk/tsconfig.json ./packages/sdk/
COPY packages/cloud/package.json packages/cloud/tsconfig.json ./packages/cloud/

# Install dependencies only (skip prepare scripts that build SDK)
# SDK will be built at runtime after volume mount
RUN bun install --no-link --ignore-scripts

CMD ["echo", "Ready to run services"]
